---
title: J在Ubuntu机器上安装JHipster
tags: JHipster, SpringMVC
date: 2016/08/21 09:30:00
categories: Java
---

在Ubuntu机器上安装JHipster
=========================

>环境： 阿里云 Ubuntu 

>`Linux 3.13.0-86-generic #130-Ubuntu SMP Mon Apr 18 18:27:15 UTC 2016 x86_64 x86_64 x86_64 GNU/Linux`


### 安装Java

使用root登录,使用如下命令，安装java8

```bash
apt-get install python-software-properties
apt-get install software-properties-common
add-apt-repository ppa:webupd8team/java
apt-get update
apt-get install oracle-java8-installer
apt-get install oracle-java8-set-default
```
安装过程中需要确认Oracle的用户协议，直接YES。
安装好后检查Java版本

```bash
# java -version
java version "1.8.0_101"
Java(TM) SE Runtime Environment (build 1.8.0_101-b13)
Java HotSpot(TM) 64-Bit Server VM (build 25.101-b13, mixed mode)
```

### 安装MySQL

```bash
apt-get install mysql-server mysql-client
```
安装过程中需要输入数据库`root`密码。

安装好后检查:

```bash
# mysql -uroot -p
Enter password:
Welcome to the MySQL monitor.  Commands end with ; or \g.
Your MySQL connection id is 42
Server version: 5.5.50-0ubuntu0.14.04.1 (Ubuntu)

Copyright (c) 2000, 2016, Oracle and/or its affiliates. All rights reserved.

Oracle is a registered trademark of Oracle Corporation and/or its
affiliates. Other names may be trademarks of their respective
owners.

Type 'help;' or '\h' for help. Type '\c' to clear the current input statement.

mysql>
```

#### 允许mysql提供远程访问

修改/etc/mysql/my.cnf

```
# Instead of skip-networking the default is now to listen only on
# localhost which is more compatible and is not less secure.
bind-address            = 0.0.0.0 #127.0.0.1
```



重启mysql `service mysql restart`，然后创建数据库和用户


```sql
create database YOUR_DATABASE DEFAULT CHARACTER SET utf8 COLLATE utf8_general_ci;

CREATE USER 'YOUR_USERNAME'@'%' IDENTIFIED BY 'YOUR_PASSWORD';

GRANT ALL PRIVILEGES ON YOUR_DATABASE.* TO 'YOUR_USERNAME'@'%';

FLUSH PRIVILEGES;

show databases;
```

使用`mysql -h SERVER_IP -u YOUR_USERNAME  -p`检查是否能连上MySQL服务器。


MySQL的一些问题

> Incorrect table definition; there can be only one TIMESTAMP column with CURRENT_TIMESTAMP in DEFAULT or ON UPDATE clause

之前一个数据库没有遇到过，通过`select version();`查看MySQL版本，以前的数据库版本是`5.6.31-0ubuntu0.15.10.1`， 而现在的版本是`5.5.50-0ubuntu0.14.04.1`。因为版本低有这个限制，查看资料，在`5.6.5`之后，这个问题不存在了。

解决方案：[升级MySQL](https://iyaozhen.com/ubuntu-upgrade-mysql-to-5-7.html)

```
wget http://dev.mysql.com/get/mysql-apt-config_0.7.3-1_all.deb

dpkg -i mysql-apt-config_0.7.3-1_all.deb

apt-get update

apt-get install mysql-server

mysql_upgrade -u root -p


```

关于配置优化的好网站：[http://tools.percona.com/](http://tools.percona.com/) (Free online productivity tools for MySQL DBAs, SysAdmins and Developers)。


> THIS IS YOUR MYSQL CONFIGURATION FILE!

> You can find your generated MySQL server configuration below. You can place this into your my.cnf or my.ini file. Remember, although this is designed to be a good starting configuration for installing a new server, it may not include all options you need. This configuration should not be used to fine-tune an existing server.


```
# Generated by Percona Configuration Wizard (http://tools.percona.com/) version REL5-20120208

[mysql]

# CLIENT #
port                           = 3306
socket                         = /var/lib/mysql/mysql.sock

[mysqld]

# GENERAL #
user                           = mysql
default-storage-engine         = InnoDB
socket                         = /var/lib/mysql/mysql.sock
pid-file                       = /var/lib/mysql/mysql.pid

# MyISAM #
key-buffer-size                = 32M
#myisam-recover                 = FORCE,BACKUP

# SAFETY #
max-allowed-packet             = 16M
max-connect-errors             = 1000000
skip-name-resolve
sysdate-is-now                 = 1

# DATA STORAGE #
datadir                        = /var/lib/mysql/

# BINARY LOGGING #
server-id                      = 12345678
log-bin                        = /var/lib/mysql/mysql-bin
expire-logs-days               = 14
sync-binlog                    = 1

# CACHES AND LIMITS #
tmp-table-size                 = 32M
max-heap-table-size            = 32M
query-cache-type               = 0
query-cache-size               = 0
max-connections                = 500
thread-cache-size              = 50
open-files-limit               = 65535
table-definition-cache         = 4096
table-open-cache               = 4096

# INNODB #
innodb-flush-method            = O_DIRECT
innodb-log-files-in-group      = 2
innodb-log-file-size           = 128M
innodb-flush-log-at-trx-commit = 1
innodb-file-per-table          = 1
innodb-buffer-pool-size        = 2G

# LOGGING #
log-error                      = /var/lib/mysql/mysql-error.log
log-queries-not-using-indexes  = 1
slow-query-log                 = 1
slow-query-log-file            = /var/lib/mysql/mysql-slow.log

```
 
生成的配置文件中没有`server-id                      = 12345678`,自己加一下。随便取个值，不同机器上不重复就行了。

> server-id参数用于在复制中，为主库和备库提供一个独立的ID，以区分主库和备库；开启二进制文件的时候，需要设置这个参数。


`#myisam-recover                 = FORCE,BACKUP` 不认这个配置项 

```
[ERROR] unknown variable 'myisam-recover=FORCE,BACKUP'
```

注释掉，之后就能起来了。

```
# service mysql start
No directory, logging in with HOME=/
...
 * MySQL Community Server 5.7.14 is started
```

### 安装Docker

安装文档: [https://docs.docker.com/engine/installation/linux/ubuntulinux/](https://docs.docker.com/engine/installation/linux/ubuntulinux/)

安装命令:

准备:

```
apt-get install apt-transport-https ca-certificates
apt-key adv --keyserver hkp://p80.pool.sks-keyservers.net:80 --recv-keys 58118E89F3A912897C070ADBF76221572C52609D
```

编辑`/etc/apt/sources.list.d/docker.list`文件，内容按Ubuntu版本不同而不同，请参考安装文档。

用`cat /etc/issue`查看Ubuntu版本号。

```
# cat /etc/issue
Ubuntu 14.04.4 LTS
```

保存好文件后，继续执行命令：

```
apt-get update

apt-get purge lxc-docker

apt-cache policy docker-engine

apt-get update

apt-get install linux-image-extra-$(uname -r) linux-image-extra-virtual


```
安装Docker

```
apt-get install docker-engine
```

启动Docker

```
service docker start
```

#### 启动Jekins

使用Docker安装Jekins

```
# docker run -d --name jenkins2 -p 18080:8080 -p 50000:50000 jenkinsci/jenkins
```

在通过服务器的18080端口可以访问Jekins。

网页要求访问`/var/jenkins_home/secrets/initialAdminPassword`获取初始密码。

>Unlock Jenkins
>To ensure Jenkins is securely set up by the administrator, a password has been written to the log (not sure where to find it?) and this file on the server:

>`/var/jenkins_home/secrets/initialAdminPassword`

>Please copy the password from either location and paste it below.

执行如下命令，从docker容器中获取文件内容：

```
docker exec jenkins2 cat /var/jenkins_home/secrets/initialAdminPassword
```

登录后，安装基本插件，并按[http://jhipster.cn/setting-up-ci-jenkins2/](http://jhipster.cn/setting-up-ci-jenkins2/)进行Nodejs的插件配置。



#### 安装Nodejs，npm，bower，gulp，yo等前端工具

添加nodejs源

`curl -sL https://deb.nodesource.com/setup_6.x | sudo bash -`

运行`apt-get install nodejs`安装nodejs 6.x 和 npm

安装npm工具

```
npm install -g bower yo gulp-cli

```











